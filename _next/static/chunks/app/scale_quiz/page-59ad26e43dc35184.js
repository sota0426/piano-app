(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[477],{3317:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>r});var s=l(5155),n=l(8999),a=l(2115);let r=()=>{let[e,t]=(0,a.useState)(new Set),[l,r]=(0,a.useState)(new Map),[o,i]=(0,a.useState)(null),[c,d]=(0,a.useState)([]),[x,m]=(0,a.useState)(null),[u,h]=(0,a.useState)({correct:0,total:0}),[g,b]=(0,a.useState)(!1),[y,p]=(0,a.useState)(!1),[f,w]=(0,a.useState)(!1),[v,j]=(0,a.useState)(!1),[N,k]=(0,a.useState)(0),C=(0,n.useRouter)(),[D,T]=(0,a.useState)({minNotes:1,maxNotes:3,noteRange:"basic4"}),A=(0,a.useRef)(null),E={C4:261.63,"C#4":277.18,D4:293.66,"D#4":311.13,E4:329.63,F4:349.23,"F#4":369.99,G4:392,"G#4":415.3,A4:440,"A#4":466.16,B4:493.88,C5:523.25,"C#5":554.37,D5:587.33,"D#5":622.25,E5:659.25,F5:698.46,"F#5":739.99,G5:783.99},S={a:"C4",w:"C#4",s:"D4",e:"D#4",d:"E4",f:"F4",t:"F#4",g:"G4",y:"G#4",h:"A4",u:"A#4",j:"B4",k:"C5",o:"C#5",l:"D5",p:"D#5",";":"E5",":":"F5"},F=[{note:"C4",type:"white",key:"a",solfege:"ド"},{note:"C#4",type:"black",key:"w",solfege:"ド#"},{note:"D4",type:"white",key:"s",solfege:"レ"},{note:"D#4",type:"black",key:"e",solfege:"レ#"},{note:"E4",type:"white",key:"d",solfege:"ミ"},{note:"F4",type:"white",key:"f",solfege:"ファ"},{note:"F#4",type:"black",key:"t",solfege:"ファ#"},{note:"G4",type:"white",key:"g",solfege:"ソ"},{note:"G#4",type:"black",key:"y",solfege:"ソ#"},{note:"A4",type:"white",key:"h",solfege:"ラ"},{note:"A#4",type:"black",key:"u",solfege:"ラ#"},{note:"B4",type:"white",key:"j",solfege:"シ"},{note:"C5",type:"white",key:"k",solfege:"ド"},{note:"C#5",type:"black",key:"o",solfege:"ド#"},{note:"D5",type:"white",key:"l",solfege:"レ"},{note:"D#5",type:"black",key:"p",solfege:"レ#"},{note:"E5",type:"white",key:";",solfege:"ミ"},{note:"F5",type:"white",key:"'",solfege:"ファ"}],G=()=>{let e=[];switch(D.noteRange){case"basic4":default:e=["C4","D4","E4","F4"];break;case"high4":e=["G4","A4","B4","C5"];break;case"diatonic8":e=["C4","D4","E4","F4","G4","A4","B4","C5"];break;case"white12":e=F.filter(e=>"white"===e.type).map(e=>e.note);break;case"all18":e=F.map(e=>e.note)}return e};(0,a.useEffect)(()=>{let e=()=>{(()=>{try{let e=window;A.current=new(e.AudioContext||e.webkitAudioContext),console.log("Web Audio API initialized successfully")}catch(e){console.error("Failed to initialize Web Audio API:",e)}})(),A.current&&"suspended"===A.current.state&&A.current.resume(),document.removeEventListener("click",e),document.removeEventListener("keydown",e)};return document.addEventListener("click",e),document.addEventListener("keydown",e),()=>{document.removeEventListener("click",e),document.removeEventListener("keydown",e),A.current&&A.current.close()}},[]);let R=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;if(!A.current)return;let l=A.current,s=l.createOscillator(),n=l.createGain();s.connect(n),n.connect(l.destination),s.frequency.setValueAtTime(e,l.currentTime),s.type="triangle",n.gain.setValueAtTime(0,l.currentTime),n.gain.linearRampToValueAtTime(.3,l.currentTime+.02),n.gain.linearRampToValueAtTime(.2,l.currentTime+.1*t),n.gain.linearRampToValueAtTime(.15,l.currentTime+.8*t),n.gain.exponentialRampToValueAtTime(.001,l.currentTime+t),s.start(l.currentTime),s.stop(l.currentTime+t)},L=(0,a.useCallback)(function(e){let l=!(arguments.length>1)||void 0===arguments[1]||arguments[1],s=E[e];if(s&&(R(s,.8),l)){let l="".concat(e,"-").concat(Date.now());t(e=>new Set([...e,l])),r(t=>new Map(t.set(e,Date.now()))),setTimeout(()=>{t(e=>{let t=new Set(e);return t.delete(l),t})},300)}},[]),M=async()=>{if(o&&A.current){b(!0);for(let e=0;e<o.length;e++){let t=E[o[e]];t&&R(t,.8),e<o.length-1&&await new Promise(e=>setTimeout(e,1e3))}await new Promise(e=>setTimeout(e,500)),b(!1)}},z=e=>{let t=Date.now();if(t-N<100||(k(t),!o||"correct"===x||g||!G().includes(e)))return;L(e,!0);let l=[...c,e];d(l),l.length===o.length&&(l.every((e,t)=>e===o[t])?(m("correct"),h(e=>({correct:e.correct+1,total:e.total+1}))):(m("incorrect"),h(e=>({...e,total:e.total+1}))))},B=(e,t)=>{t.preventDefault(),z(e)};(0,a.useEffect)(()=>{let e=e=>{let t=S[e.key.toLowerCase()];t&&(e.preventDefault(),z(t))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[c,o,x,g,D,N]);let V=e=>!G().includes(e);return(0,s.jsxs)("div",{className:"h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex flex-col overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 bg-white/80 backdrop-blur-sm shadow-sm",children:[(0,s.jsx)("button",{onClick:()=>w(!f),className:"rounded-md bg-gray-200 px-3 py-2 text-gray-700 hover:bg-gray-300 relative",children:(0,s.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,s.jsx)("div",{className:"w-4 h-0.5 bg-gray-600"}),(0,s.jsx)("div",{className:"w-4 h-0.5 bg-gray-600"}),(0,s.jsx)("div",{className:"w-4 h-0.5 bg-gray-600"})]})}),(0,s.jsx)("h1",{className:"text-xl font-bold text-indigo-800 flex items-center gap-2",children:"\uD83C\uDFB9 ピアノ音当てクイズ"}),(0,s.jsx)("button",{onClick:()=>j(!v),className:"rounded-md bg-indigo-100 px-3 py-2 text-indigo-700 hover:bg-indigo-200",children:"？"})]}),f&&(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50 flex items-start justify-start z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-r-lg p-6 h-full min-w-80 shadow-xl",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-bold",children:"メニュー"}),(0,s.jsx)("button",{onClick:()=>w(!1),className:"text-gray-500 hover:text-gray-700 text-xl",children:"✕"})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-gray-800 mb-2",children:"スコア"}),(0,s.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,s.jsxs)("div",{className:"text-2xl font-bold text-gray-800 mb-1",children:[u.correct," / ",u.total]}),(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["正答率: ",u.total>0?Math.round(u.correct/u.total*100):0,"%"]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-gray-800 mb-3",children:"設定"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-600 mb-2",children:"音数設定"}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"最小"}),(0,s.jsxs)("select",{value:D.minNotes,onChange:e=>T(t=>({...t,minNotes:parseInt(e.target.value)})),className:"ml-1 px-2 py-1 border rounded text-sm",children:[(0,s.jsx)("option",{value:1,children:"1音"}),(0,s.jsx)("option",{value:2,children:"2音"}),(0,s.jsx)("option",{value:3,children:"3音"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"最大"}),(0,s.jsxs)("select",{value:D.maxNotes,onChange:e=>T(t=>({...t,maxNotes:parseInt(e.target.value)})),className:"ml-1 px-2 py-1 border rounded text-sm",children:[(0,s.jsx)("option",{value:1,children:"1音"}),(0,s.jsx)("option",{value:2,children:"2音"}),(0,s.jsx)("option",{value:3,children:"3音"}),(0,s.jsx)("option",{value:4,children:"4音"}),(0,s.jsx)("option",{value:5,children:"5音"})]})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-600 mb-2",children:"音の範囲"}),(0,s.jsxs)("select",{value:D.noteRange,onChange:e=>T(t=>({...t,noteRange:e.target.value})),className:"w-full px-3 py-2 border rounded text-sm",children:[(0,s.jsx)("option",{value:"basic4",children:"基本4音：ド・レ・ミ・ファ（超簡単）"}),(0,s.jsx)("option",{value:"high4",children:"高音4音：ソ・ラ・シ・ド（超簡単）"}),(0,s.jsx)("option",{value:"diatonic8",children:"ドレミファソラシド（簡単）"}),(0,s.jsx)("option",{value:"white12",children:"白鍵のみ（中級）"}),(0,s.jsx)("option",{value:"all18",children:"全ての音（上級）"})]})]})]})]}),(0,s.jsx)("div",{className:"border-t pt-4",children:(0,s.jsx)("button",{onClick:()=>C.push("/"),className:"w-full px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"← タイトルに戻る"})})]})]})}),v&&(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-bold",children:"遊び方"}),(0,s.jsx)("button",{onClick:()=>j(!1),className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),(0,s.jsxs)("div",{className:"text-sm space-y-2",children:[(0,s.jsx)("p",{children:"1. 「新しい問題」で問題作成"}),(0,s.jsx)("p",{children:"2. 「問題を聞く」で音列再生"}),(0,s.jsx)("p",{children:"3. 鍵盤で順番に音を入力"}),(0,s.jsx)("p",{children:"4. 全音入力で自動採点"}),(0,s.jsx)("p",{children:"5. ハンバーガーメニュー（三）で設定変更"})]})]})}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col p-3 gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm px-4 py-2",children:(0,s.jsxs)("div",{className:"text-lg font-bold text-gray-800",children:[u.correct," / ",u.total]})}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>{let e=G(),t=Math.floor(Math.random()*(D.maxNotes-D.minNotes+1))+D.minNotes,l=[];for(let s=0;s<t;s++){let t=e[Math.floor(Math.random()*e.length)];l.push(t)}i(l),d([]),m(null),p(!1),console.log("Generated quiz:",l)},disabled:g,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:bg-gray-400 font-medium",children:"新しい問題"}),(0,s.jsxs)("button",{onClick:M,disabled:!o||g,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:bg-gray-400 flex items-center gap-1",children:["▶ ",g?"再生中":"問題を聞く"]}),o&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>{d([]),m(null)},disabled:g,className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:bg-gray-400",children:"リセット"}),(0,s.jsx)("button",{onClick:()=>{p(!y)},className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:y?"答えを隠す":"答えを見る"})]})]})]}),o&&(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"font-mono text-lg bg-white rounded p-2 shadow-sm mb-2",children:c.length>0?c.join(" → "):"(鍵盤で音を入力してください)"}),x&&(0,s.jsx)("div",{className:"text-xl font-bold mb-2 ".concat("correct"===x?"text-green-600":"text-red-600"),children:"correct"===x?"\uD83C\uDF89 正解！":"❌ 不正解"}),y&&(0,s.jsxs)("div",{className:"text-sm bg-yellow-50 border border-yellow-200 rounded p-2",children:[(0,s.jsx)("strong",{children:"正解:"})," ",o.join(" → ")]})]}),(0,s.jsx)("div",{className:"flex-1 flex justify-center items-end",children:(0,s.jsx)("div",{className:"relative bg-gray-200 p-2 rounded-xl shadow-lg overflow-x-auto",children:(0,s.jsxs)("div",{className:"relative flex justify-center min-w-[500px] max-w-[90vw] md:min-w-[600px] lg:min-w-[700px] xl:min-w-[800px]",children:[(0,s.jsx)("div",{className:"flex",children:F.filter(e=>"white"===e.type).map((t,l)=>{var n;let a=Array.from(e).some(e=>e.startsWith(t.note)),r=c.includes(t.note),o=V(t.note),i="bg-white";return o?i="bg-gray-100 text-gray-300 border-gray-200":a?i="bg-blue-200 border-blue-400":r&&(i="bg-yellow-100 border-yellow-400"),(0,s.jsxs)("button",{onTouchStart:e=>{o||B(t.note,e)},onMouseDown:e=>{o||B(t.note,e)},disabled:o||g,className:"\n                        w-12 h-36 md:w-16 md:h-48 lg:w-20 lg:h-56 xl:w-24 xl:h-64 border border-gray-300 rounded-b-xl\n                        transition-all duration-300 flex flex-col justify-end items-center pb-2 md:pb-3 lg:pb-4\n                        ".concat(i,"\n                        ").concat(a?"animate-pulse":"","\n                        ").concat(o?"cursor-not-allowed opacity-50":"hover:bg-gray-50 active:bg-gray-100 cursor-pointer","\n                        touch-manipulation\n                      "),children:[(0,s.jsx)("span",{className:"text-xs md:text-sm lg:text-base font-bold mb-1 ".concat(o?"text-gray-300":"text-gray-800"),children:null==(n=t.key)?void 0:n.toUpperCase()}),(0,s.jsx)("span",{className:"text-xs md:text-sm ".concat(o?"text-gray-300":"text-gray-600"),children:t.solfege})]},t.note)})}),(0,s.jsx)("div",{className:"absolute top-0 left-0 flex",children:F.filter(e=>"black"===e.type).map(t=>{var l;let n=F.filter(e=>"white"===e.type&&F.indexOf(e)<F.indexOf(t)).length,a=Array.from(e).some(e=>e.startsWith(t.note)),r=c.includes(t.note),o=V(t.note),i="bg-black";return o?i="bg-gray-400 text-gray-300 border-gray-500":a?i="bg-blue-600 border-blue-500":r&&(i="bg-yellow-600 border-yellow-500"),(0,s.jsxs)("button",{onTouchStart:e=>{o||B(t.note,e)},onMouseDown:e=>{o||B(t.note,e)},disabled:o||g,style:{left:"".concat(48*n-18+4,"px")},className:"\n                        absolute w-8 h-24 md:w-12 md:h-32 lg:w-14 lg:h-40 xl:w-16 xl:h-44 border border-gray-800 rounded-b-lg shadow-2xl text-white\n                        transition-all duration-300 flex flex-col justify-end items-center pb-2 md:pb-3 z-10\n                        ".concat(i,"\n                        ").concat(a?"animate-pulse":"","\n                        ").concat(o?"cursor-not-allowed opacity-50":"hover:bg-gray-800 active:bg-gray-700 cursor-pointer","\n                        touch-manipulation\n                      "),children:[(0,s.jsx)("span",{className:"text-xs md:text-sm font-bold bg-black bg-opacity-50 px-1 rounded mb-1 ".concat(o?"text-gray-300":"text-white"),children:null==(l=t.key)?void 0:l.toUpperCase()}),(0,s.jsx)("span",{className:"text-xs md:text-sm ".concat(o?"text-gray-300":""),children:t.solfege})]},t.note)})})]})})})]})]})}},8533:(e,t,l)=>{Promise.resolve().then(l.bind(l,3317))}},e=>{e.O(0,[441,964,358],()=>e(e.s=8533)),_N_E=e.O()}]);