(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[477],{3317:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});var s=n(5155),l=n(8999),a=n(2115);let r=()=>{let[e,t]=(0,a.useState)(new Set),[n,r]=(0,a.useState)(new Map),[o,i]=(0,a.useState)(null),[c,d]=(0,a.useState)([]),[x,u]=(0,a.useState)(null),[m,h]=(0,a.useState)({correct:0,total:0}),[g,y]=(0,a.useState)(!1),[p,b]=(0,a.useState)(!1),[j,f]=(0,a.useState)(!1),v=(0,l.useRouter)(),[w,N]=(0,a.useState)({minNotes:1,maxNotes:3,noteRange:"basic4"}),k=(0,a.useRef)(null),C={C4:261.63,"C#4":277.18,D4:293.66,"D#4":311.13,E4:329.63,F4:349.23,"F#4":369.99,G4:392,"G#4":415.3,A4:440,"A#4":466.16,B4:493.88,C5:523.25,"C#5":554.37,D5:587.33,"D#5":622.25,E5:659.25,F5:698.46,"F#5":739.99,G5:783.99},D={a:"C4",w:"C#4",s:"D4",e:"D#4",d:"E4",f:"F4",t:"F#4",g:"G4",y:"G#4",h:"A4",u:"A#4",j:"B4",k:"C5",o:"C#5",l:"D5",p:"D#5",";":"E5",":":"F5"},A=[{note:"C4",type:"white",key:"a",solfege:"ド"},{note:"C#4",type:"black",key:"w",solfege:"ド#"},{note:"D4",type:"white",key:"s",solfege:"レ"},{note:"D#4",type:"black",key:"e",solfege:"レ#"},{note:"E4",type:"white",key:"d",solfege:"ミ"},{note:"F4",type:"white",key:"f",solfege:"ファ"},{note:"F#4",type:"black",key:"t",solfege:"ファ#"},{note:"G4",type:"white",key:"g",solfege:"ソ"},{note:"G#4",type:"black",key:"y",solfege:"ソ#"},{note:"A4",type:"white",key:"h",solfege:"ラ"},{note:"A#4",type:"black",key:"u",solfege:"ラ#"},{note:"B4",type:"white",key:"j",solfege:"シ"},{note:"C5",type:"white",key:"k",solfege:"ド"},{note:"C#5",type:"black",key:"o",solfege:"ド#"},{note:"D5",type:"white",key:"l",solfege:"レ"},{note:"D#5",type:"black",key:"p",solfege:"レ#"},{note:"E5",type:"white",key:";",solfege:"ミ"},{note:"F5",type:"white",key:"'",solfege:"ファ"}],E=()=>{let e=[];switch(w.noteRange){case"basic4":default:e=["C4","D4","E4","F4"];break;case"high4":e=["G4","A4","B4","C5"];break;case"diatonic8":e=["C4","D4","E4","F4","G4","A4","B4","C5"];break;case"white12":e=A.filter(e=>"white"===e.type).map(e=>e.note);break;case"all18":e=A.map(e=>e.note)}return e};(0,a.useEffect)(()=>{let e=()=>{(()=>{try{let e=window;k.current=new(e.AudioContext||e.webkitAudioContext),console.log("Web Audio API initialized successfully")}catch(e){console.error("Failed to initialize Web Audio API:",e)}})(),k.current&&"suspended"===k.current.state&&k.current.resume(),document.removeEventListener("click",e),document.removeEventListener("keydown",e)};return document.addEventListener("click",e),document.addEventListener("keydown",e),()=>{document.removeEventListener("click",e),document.removeEventListener("keydown",e),k.current&&k.current.close()}},[]);let T=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;if(!k.current)return;let n=k.current,s=n.createOscillator(),l=n.createGain();s.connect(l),l.connect(n.destination),s.frequency.setValueAtTime(e,n.currentTime),s.type="triangle",l.gain.setValueAtTime(0,n.currentTime),l.gain.linearRampToValueAtTime(.3,n.currentTime+.02),l.gain.linearRampToValueAtTime(.2,n.currentTime+.1*t),l.gain.linearRampToValueAtTime(.15,n.currentTime+.8*t),l.gain.exponentialRampToValueAtTime(.001,n.currentTime+t),s.start(n.currentTime),s.stop(n.currentTime+t)},F=(0,a.useCallback)(function(e){let n=!(arguments.length>1)||void 0===arguments[1]||arguments[1],s=C[e];if(s&&(T(s,.8),n)){let n="".concat(e,"-").concat(Date.now());t(e=>new Set([...e,n])),r(t=>new Map(t.set(e,Date.now()))),setTimeout(()=>{t(e=>{let t=new Set(e);return t.delete(n),t})},300)}},[]),S=async()=>{if(o&&k.current){y(!0);for(let e=0;e<o.length;e++){let t=C[o[e]];t&&T(t,.8),e<o.length-1&&await new Promise(e=>setTimeout(e,1e3))}await new Promise(e=>setTimeout(e,500)),y(!1)}},G=e=>{if(!o||"correct"===x||g||!E().includes(e))return;F(e,!0);let t=[...c,e];d(t),t.length===o.length&&(t.every((e,t)=>e===o[t])?(u("correct"),h(e=>({correct:e.correct+1,total:e.total+1}))):(u("incorrect"),h(e=>({...e,total:e.total+1}))))};(0,a.useEffect)(()=>{let e=e=>{let t=D[e.key.toLowerCase()];t&&G(t)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[c,o,x,g,w]);let R=e=>!E().includes(e);return(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,s.jsx)("button",{onClick:()=>v.push("/"),className:"rounded-md bg-gray-200 px-4 py-2 text-sm text-gray-700 hover:bg-gray-300",children:"← タイトルに戻る"}),(0,s.jsx)("h1",{className:"text-4xl font-bold text-indigo-800 text-center mb-8 mt-12",children:"\uD83C\uDFB9 ピアノ音当てクイズ"}),(0,s.jsx)("div",{className:"flex justify-center mb-6",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-4 text-center",children:[(0,s.jsxs)("div",{className:"text-2xl font-bold text-gray-800",children:["スコア: ",m.correct," / ",m.total]}),(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["正答率: ",m.total>0?Math.round(m.correct/m.total*100):0,"%"]})]})}),(0,s.jsx)("div",{className:"flex justify-center mb-6",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-4",style:{width:"736px"},children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-800",children:"設定"}),(0,s.jsx)("button",{onClick:()=>f(!j),className:"px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors text-sm",children:j?"閉じる":"設定を変更"})]}),j&&(0,s.jsxs)("div",{className:"space-y-4 border-t pt-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"出題音数"}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm text-gray-600",children:"最小"}),(0,s.jsxs)("select",{value:w.minNotes,onChange:e=>N(t=>({...t,minNotes:parseInt(e.target.value)})),className:"ml-2 px-2 py-1 border rounded",children:[(0,s.jsx)("option",{value:1,children:"1音"}),(0,s.jsx)("option",{value:2,children:"2音"}),(0,s.jsx)("option",{value:3,children:"3音"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm text-gray-600",children:"最大"}),(0,s.jsxs)("select",{value:w.maxNotes,onChange:e=>N(t=>({...t,maxNotes:parseInt(e.target.value)})),className:"ml-2 px-2 py-1 border rounded",children:[(0,s.jsx)("option",{value:1,children:"1音"}),(0,s.jsx)("option",{value:2,children:"2音"}),(0,s.jsx)("option",{value:3,children:"3音"}),(0,s.jsx)("option",{value:4,children:"4音"}),(0,s.jsx)("option",{value:5,children:"5音"})]})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"使用する音の範囲"}),(0,s.jsxs)("select",{value:w.noteRange,onChange:e=>N(t=>({...t,noteRange:e.target.value})),className:"px-3 py-2 border rounded w-full",children:[(0,s.jsx)("option",{value:"basic4",children:"基本4音：ド・レ・ミ・ファ（超簡単）"}),(0,s.jsx)("option",{value:"high4",children:"高音4音：ソ・ラ・シ・ド（超簡単）"}),(0,s.jsx)("option",{value:"diatonic8",children:"ドレミファソラシド（簡単）"}),(0,s.jsx)("option",{value:"white12",children:"白鍵のみ（中級）"}),(0,s.jsx)("option",{value:"all18",children:"全ての音（上級）"})]})]})]}),!j&&(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["現在の設定: ",w.minNotes,"～",w.maxNotes,"音, ",(()=>{switch(w.noteRange){case"basic4":default:return"基本4音（ド・レ・ミ・ファ）";case"high4":return"高音4音（ソ・ラ・シ・ド）";case"diatonic8":return"ドレミファソラシド（8音）";case"white12":return"白鍵のみ（12音）";case"all18":return"全ての音（18音）"}})()]})]})}),(0,s.jsx)("div",{className:"flex justify-center mb-8",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",style:{width:"736px"},children:[(0,s.jsxs)("div",{className:"flex gap-4 items-center justify-center mb-4",children:[(0,s.jsx)("button",{onClick:()=>{let e=E(),t=Math.floor(Math.random()*(w.maxNotes-w.minNotes+1))+w.minNotes,n=[];for(let s=0;s<t;s++){let t=e[Math.floor(Math.random()*e.length)];n.push(t)}i(n),d([]),u(null),b(!1),console.log("Generated quiz:",n)},disabled:g,className:"px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium",children:"新しい問題"}),(0,s.jsxs)("button",{onClick:S,disabled:!o||g,className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium flex items-center gap-2",children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M8 5v14l11-7z"})}),g?"再生中...":"問題を聞く"]}),o&&(0,s.jsx)("button",{onClick:()=>{d([]),u(null)},disabled:g,className:"px-4 py-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 disabled:bg-gray-400 transition-colors font-medium",children:"答えをリセット"})]}),o&&(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("span",{className:"text-lg font-medium text-gray-700",children:["問題: ",o.length,"音の音列"]})}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("span",{className:"text-md text-gray-600",children:["あなたの答え (",c.length,"/",o.length,"):"]}),(0,s.jsx)("span",{className:"ml-2 font-mono text-lg",children:c.length>0?c.join(" → "):"(まだ入力されていません)"})]}),x&&(0,s.jsx)("div",{className:"text-2xl font-bold mb-4 ".concat("correct"===x?"text-green-600":"text-red-600"),children:"correct"===x?"\uD83C\uDF89 正解！":"❌ 不正解"}),o&&(0,s.jsx)("button",{onClick:()=>{b(!p)},className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm",children:p?"答えを隠す":"答えを見る"}),p&&(0,s.jsxs)("div",{className:"mt-4 p-4 bg-gray-100 rounded-lg",children:[(0,s.jsx)("span",{className:"text-md font-medium text-gray-700",children:"正解:"}),(0,s.jsx)("span",{className:"ml-2 font-mono text-lg text-gray-800",children:o.join(" → ")})]})]}),!o&&(0,s.jsx)("div",{className:"text-center text-gray-600",children:"「新しい問題」ボタンを押してクイズを開始してください"})]})}),(0,s.jsx)("div",{className:"flex justify-center px-8 mb-8",children:(0,s.jsxs)("div",{className:"relative bg-gray-200 p-4 rounded-2xl shadow-lg",style:{width:"736px"},children:[(0,s.jsx)("div",{className:"text-center mb-4 text-gray-700 font-medium",children:"キーボードまたはクリックで音を入力"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"flex",children:A.filter(e=>"white"===e.type).map(t=>{var l;let a=Array.from(e).some(e=>e.startsWith(t.note)),r=c.includes(t.note),o=R(t.note);n.get(t.note);let i="bg-white";return o?i="bg-gray-100 text-gray-300 border-gray-200":a?i="bg-blue-200 border-blue-400":r&&(i="bg-yellow-100 border-yellow-400"),(0,s.jsxs)("button",{onMouseDown:()=>!o&&G(t.note),disabled:o||g,className:"\n                        w-16 h-64 border border-gray-300 rounded-b-xl\n                        transition-all duration-300 flex flex-col justify-end items-center pb-4\n                        ".concat(i,"\n                        ").concat(a?"animate-pulse":"","\n                        ").concat(o?"cursor-not-allowed opacity-50":"hover:bg-gray-50 active:bg-gray-100 cursor-pointer","\n                      "),style:{animationDuration:"0.6s",animationIterationCount:"1"},children:[(0,s.jsx)("span",{className:"text-sm font-bold mb-1 ".concat(o?"text-gray-300":"text-gray-800"),children:null==(l=t.key)?void 0:l.toUpperCase()}),(0,s.jsx)("span",{className:"text-xs opacity-80 ".concat(o?"text-gray-300":"text-gray-600"),children:t.note}),(0,s.jsx)("span",{className:"text-xs opacity-80 ".concat(o?"text-gray-300":"text-gray-600"),children:t.solfege}),"                    "]},t.note)})}),(0,s.jsxs)("div",{className:"absolute top-0 left-0 flex",children:[A.filter(e=>"black"===e.type).map(t=>{var l;let a=A.filter(e=>"white"===e.type&&A.indexOf(e)<A.indexOf(t)).length,r=Array.from(e).some(e=>e.startsWith(t.note)),o=c.includes(t.note),i=R(t.note);n.get(t.note);let d="bg-black";return i?d="bg-gray-400 text-gray-300 border-gray-500":r?d="bg-blue-600 border-blue-500":o&&(d="bg-yellow-600 border-yellow-500"),(0,s.jsxs)("button",{onMouseDown:()=>!i&&G(t.note),disabled:i||g,style:{left:"".concat(64*a-24+4,"px")},className:"\n                        absolute w-12 h-40 border border-gray-800 rounded-b-lg shadow-2xl text-white\n                        transition-all duration-300 flex flex-col justify-end items-center pb-4 z-10\n                        ".concat(d,"\n                        ").concat(r?"animate-pulse":"","\n                        ").concat(i?"cursor-not-allowed opacity-50":"hover:bg-gray-800 active:bg-gray-700 cursor-pointer","\n                      "),children:[(0,s.jsx)("span",{className:"text-xs font-bold bg-black bg-opacity-50 px-1 py-0.5 rounded mb-1 ".concat(i?"text-gray-300":"text-white"),children:null==(l=t.key)?void 0:l.toUpperCase()}),(0,s.jsx)("span",{className:"text-xs opacity-75 ".concat(i?"text-gray-300":""),children:t.note}),(0,s.jsx)("span",{className:"text-xs opacity-75 ".concat(i?"text-gray-300":""),children:t.solfege}),"                    "]},t.note)}),"l"]})]})]})}),(0,s.jsx)("div",{className:"flex justify-center px-8",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",style:{width:"736px"},children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-800 mb-4 text-center",children:"遊び方"}),(0,s.jsxs)("div",{className:"text-gray-700 space-y-2",children:[(0,s.jsx)("p",{children:"1. 設定で難易度を調整できます（音数・音の範囲）"}),(0,s.jsx)("p",{children:"2. グレーのキーは現在の設定では使用されません"}),(0,s.jsx)("p",{children:"3. 「新しい問題」ボタンで問題が出題されます"}),(0,s.jsx)("p",{children:"4. 「問題を聞く」ボタンで音列を再生します（何度でも可能）"}),(0,s.jsx)("p",{children:"5. 有効なピアノキーをクリック/キーボードで順番に音を入力"}),(0,s.jsx)("p",{children:"6. 全ての音を入力すると自動で採点されます"}),(0,s.jsx)("p",{children:"7. 正解すると\uD83C\uDF89、不正解だと❌が表示されます"}),(0,s.jsx)("p",{children:"8. 何度でもチャレンジできます！"})]})]})})]})})}},8533:(e,t,n)=>{Promise.resolve().then(n.bind(n,3317))}},e=>{e.O(0,[441,964,358],()=>e(e.s=8533)),_N_E=e.O()}]);